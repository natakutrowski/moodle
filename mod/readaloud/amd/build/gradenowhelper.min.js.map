{"version":3,"file":"gradenowhelper.min.js","sources":["../src/gradenowhelper.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_readaloud/definitions', 'mod_readaloud/popoverhelper'], function ($, log, def, popoverhelper) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Gradenow helper: initialising');\n\n    return {\n        //controls\n\n        controls: {},\n        currentmode: 'grading',\n\n        constants: {\n            REVIEWMODE_NONE: 0,\n            REVIEWMODE_MACHINE: 1,\n            REVIEWMODE_HUMAN: 2,\n            REVIEWMODE_SCORESONLY: 3,\n            SESSIONSCORE_STRICT: 1\n        },\n\n        //class definitions\n        cd: {\n            audioplayerclass: def.audioplayerclass,\n            wordplayerclass: def.wordplayerclass,\n            wordclass: def.wordclass,\n            spaceclass: def.spaceclass,\n            badwordclass: def.badwordclass,\n            endspaceclass: def.endspaceclass,\n            unreadwordclass: def.unreadwordclass,\n            unreadspaceclass: def.unreadspaceclass,\n            wpmscoreid: def.wpmscoreid,\n            accuracyscoreid: def.accuracyscoreid,\n            sessionscoreid: def.sessionscoreid,\n            errorscoreid: def.errorscoreid,\n            formelementwpmscore: def.formelementwpmscore,\n            formelementaccuracy: def.formelementaccuracy,\n            formelementsessionscore: def.formelementsessionscore,\n            formelementendword: def.formelementendword,\n            formelementtime: def.formelementtime,\n            formelementerrors: def.formelementerrors,\n            modebutton: def.modebutton,\n\n            spotcheckbutton: def.spotcheckbutton,\n            transcriptcheckbutton: def.transcriptcheckbutton,\n            gradingbutton: def.gradingbutton,\n            clearbutton: def.clearbutton,\n            spotcheckmode: def.spotcheckmode,\n            aiunmatched: def.aiunmatched,\n            passagecontainer: def.passagecontainer,\n\n            maybeselfcorrectclass: def.maybeselfcorrectclass,\n            selfcorrectclass: def.selfcorrectclass,\n            notesclass: def.notesclass,\n            structuralclass: def.structuralclass,\n            meaningclass: def.meaningclass,\n            visualclass: def.visualclass,\n\n        },\n\n        options: {\n            enabletts: false,\n            targetwpm: 100,\n            ttslanguage: 'en',\n            totalseconds: 60,\n            allowearlyexit: false,\n            timelimit: 60,\n            enforcemarker: true,\n            totalwordcount: 0,\n            wpm: 0,\n            accuracy: 0,\n            sessionscore: 0,\n            sessionscoremethod: 0,\n            endwordnumber: 0,\n            errorwords: {},\n            activityid: null,\n            attemptid: null,\n            sesskey: null\n        },\n\n\n        init: function (config) {\n\n            //pick up opts from html\n            var theid = '#' + config['id'];\n            var configcontrol = $(theid).get(0);\n            if (configcontrol) {\n                var opts = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('Gradenow helper js: No config found on page. Giving up.');\n                return;\n            }\n\n            //register the controls\n            this.register_controls();\n\n            //stash important info\n            this.options.activityid = opts['activityid'];\n            this.options.attemptid = opts['attemptid'];\n            this.options.sesskey = opts['sesskey'];\n            this.options.enabletts = opts['enabletts'];\n            this.options.ttslanguage = opts['ttslanguage'];\n            this.options.targetwpm = opts['targetwpm'];\n            this.options.sessionscoremethod = opts['sessionscoremethod'];\n            this.options.allowearlyexit = opts['allowearlyexit'];\n            this.options.timelimit = opts['timelimit'];\n            this.options.reviewmode = opts['reviewmode'];\n            this.options.readonly = opts['readonly'];\n            this.options.totalwordcount = $('.' + this.cd.wordclass).length;\n\n            if (opts['sessiontime'] > 0) {\n                if (opts['sessionerrors'] !== '') {\n                    this.options.errorwords = JSON.parse(opts['sessionerrors']);\n                } else {\n                    this.options.errorwords = {};\n                }\n                this.options.totalseconds = opts['sessiontime'];\n                this.options.endwordnumber = opts['sessionendword'];\n                this.options.sessionscore = opts['sessionscore'];\n                this.options.accuracy = opts['accuracy'];\n                this.options.wpm = opts['wpm'];\n\n                //We may have session matches and AI data, if AI is turned on\n                this.options.sessionmatches = JSON.parse(opts['sessionmatches']);\n                this.options.aidata = opts['aidata'];\n                if (this.options.aidata) {\n                    this.options.transcriptwords = opts['aidata'].transcript.split(\" \");\n\n                    //remove empty elements ... these can get in there\n                    this.options.transcriptwords = this.options.transcriptwords.filter(function (el) {\n                        return el !== '';\n                    });\n\n                } else {\n                    this.options.transcriptwords = [];\n                }\n\n                //if this has been graded, draw the gradestate\n                this.redrawgradestate();\n            } else {\n                //set up our end passage marker\n                this.options.endwordnumber = this.options.totalwordcount;\n            }\n\n            //add the endword marker\n            var thespace = $('#' + this.cd.spaceclass + '_' + this.options.endwordnumber);\n            thespace.addClass(this.cd.endspaceclass);\n\n            //register events\n            this.register_events();\n\n            //initialise our audio duration. We need this to calc. wpm\n            //but if allowearlyexit is false, actually we can skip waiting for audio.\n            //After audio loaded(if nec.) we call processscores to init score boxe\n            //TODO: really should get audio duration at recording time.\n            var m = this;\n            var processloadedaudio = function () {\n                if (m.options.allowearlyexit ||m.options.timelimit==0 ) {\n                    //using the audio player duration is actually more accurate than aidata.sessiontime\n                    //but it will give diff results to score used in autograding which when allowing earlyexit uses aiddata.sessiontime\n                    // (aidata.sessiontime is the end time of last recognised word.)\n                    //So to ensure consistency we also use the aidata.sessiontime here\n                    if (m.options.aidata && m.options.aidata.sessiontime) {\n                        m.options.totalseconds = m.options.aidata.sessiontime;\n                    } else {\n                        var audioplayer = $('.' + m.cd.audioplayerclass);\n                        var duration = audioplayer.prop('duration');\n                        //this can fail if audio is not loaded yet. Lets wait for it to load and reset stuff\n                        //its better not to need this, but calcs all fail if we do not know the recording time\n                        if(isNaN(duration)) {\n                            m.options.totalseconds = 0;\n                            audioplayer.on('durationchange', processloadedaudio);\n                        }else{\n                            m.options.totalseconds = Math.round(duration);\n                        }\n                    }\n                } else {\n                    m.options.totalseconds = m.options.timelimit;\n                }\n                //update form field\n                m.controls.formelementtime.val(m.options.totalseconds);\n                m.processscores();\n            };\n\n            //processloaded audio\n            processloadedaudio();\n\n            //init our popover helper which sets up the button events\n            this.init_popoverhelper();\n\n\n        },\n\n        //set up events related to popover helper\n        init_popoverhelper: function () {\n            var that = this;\n\n            //when the user clicks the reject popover accept button, we arrive here\n            popoverhelper.onReject = function () {\n                var clickwordnumber = $(this).attr('data-wordnumber');\n\n                //if nothing changed, just close the popover\n                var nochange = (clickwordnumber in that.options.errorwords);\n                if (nochange) {\n                    popoverhelper.remove();\n                    return;\n                }\n\n                //if a new choice was made update things\n                var playchain = that.fetchPlayChain(clickwordnumber);\n                for (var wordindex = playchain.startword; wordindex <= playchain.endword; wordindex++) {\n                    if (!(wordindex in that.options.errorwords)) {\n                        var theword = $('#' + that.cd.wordclass + '_' + wordindex);\n                        var thespace = $('#' + that.cd.spaceclass + '_' + wordindex);\n                        if(wordindex==clickwordnumber) {\n                            that.adderrorword(wordindex, theword.text());\n                            theword.addClass(that.cd.badwordclass);\n                            theword.addClass(that.cd.spotcheckmode);\n                            if (wordindex !== playchain.endword) {\n                                thespace.addClass(that.cd.spotcheckmode);\n                            }\n                        }\n                    }\n                }\n                //that.markup_badspaces();\n                that.markup_aiunmatchedspaces();\n                that.processscores();\n                popoverhelper.remove();\n            };\n\n            //when the user clicks the popover accept button, we arrive here\n            popoverhelper.onAccept = function () {\n                var clickwordnumber = $(this).attr('data-wordnumber');\n\n                //if nothing changed, just close the popover\n                var nochange = !(clickwordnumber in that.options.errorwords);\n                if (nochange) {\n                    popoverhelper.remove();\n                    return;\n                }\n                //if a new choice was made update things\n                var playchain = that.fetchPlayChain(clickwordnumber);\n                for (var wordindex = playchain.startword; wordindex <= playchain.endword; wordindex++) {\n                    if (wordindex in that.options.errorwords) {\n                        if(wordindex==clickwordnumber) {\n                            delete that.options.errorwords[wordindex];\n                            var theword = $('#' + that.cd.wordclass + '_' + wordindex);\n                            var thespace = $('#' + that.cd.spaceclass + '_' + wordindex);\n                            theword.removeClass(that.cd.badwordclass);\n                            theword.removeClass(that.cd.spotcheckmode);\n                            thespace.removeClass(that.cd.spotcheckmode);\n                        }\n                    }\n                }\n                //that.markup_badspaces();\n                that.markup_aiunmatchedspaces();\n                that.processscores();\n                popoverhelper.remove();\n            };\n\n            //init the popover now that we have set the correct callback event handling thingies\n            popoverhelper.init();\n        },\n\n        register_controls: function () {\n\n            this.controls.wordplayer = $('#' + this.cd.wordplayerclass);\n            this.controls.audioplayer = $('.' + this.cd.audioplayerclass);\n            this.controls.eachword = $('.' + this.cd.wordclass);\n            this.controls.eachspace = $('.' + this.cd.spaceclass);\n            this.controls.endwordmarker = $('#' + this.cd.spaceclass + '_' + this.options.endwordnumber);\n            this.controls.spotcheckword = $('.' + this.cd.spotcheckmode);\n\n            this.controls.wpmscorebox = $('#' + this.cd.wpmscoreid);\n            this.controls.accuracyscorebox = $('#' + this.cd.accuracyscoreid);\n            this.controls.sessionscorebox = $('#' + this.cd.sessionscoreid);\n            this.controls.errorscorebox = $('#' + this.cd.errorscoreid);\n\n            this.controls.formelementwpmscore = $(\"#\" + this.cd.formelementwpmscore);\n            this.controls.formelementsessionscore = $(\"#\" + this.cd.formelementsessionscore);\n            this.controls.formelementaccuracy = $(\"#\" + this.cd.formelementaccuracy);\n            this.controls.formelementendword = $(\"#\" + this.cd.formelementendword);\n            this.controls.formelementerrors = $(\"#\" + this.cd.formelementerrors);\n            this.controls.formelementtime = $(\"#\" + this.cd.formelementtime);\n\n            this.controls.passagecontainer = $(\".\" + this.cd.passagecontainer);\n\n            //passage action buttons\n            this.controls.modebutton = $(\"#\" + this.cd.modebutton);\n\n            this.controls.gradingbutton = $(\"#\" + this.cd.gradingbutton);\n            this.controls.spotcheckbutton = $(\"#\" + this.cd.spotcheckbutton);\n            this.controls.transcriptcheckbutton = $(\"#\" + this.cd.transcriptcheckbutton);\n            this.controls.clearbutton = $(\"#\" + this.cd.clearbutton);\n\n        },\n\n        register_events: function () {\n            var that = this;\n            //set up event handlers\n\n\n            //Play audio from and to spot check part\n            this.controls.passagecontainer.on('click', '.' + this.cd.spotcheckmode + ', .' + this.cd.aiunmatched, function () {\n                if (that.currentmode === 'spotcheck') {\n                    var wordnumber = parseInt($(this).attr('data-wordnumber'));\n                    that.doPlaySpotCheck(wordnumber);\n                }\n            });\n\n\n            //in review mode, do nuffink though ... thats for the student\n            if (this.options.readonly) {\n                //do nothing\n\n                //here we will put real options for playing the model reading and user reading etc\n            } else if (false) {\n                /*\n                if(this.enabletts && this.options.ttslanguage != 'none'){\n                    this.controls.eachword.click(this.playword);\n                }\n                */\n\n                //if we have AI data then turn on spotcheckmode\n                if (this.options.sessionmatches) {\n                    this.doSpotCheckMode();\n                }\n\n                //add listeners for click events\n                this.controls.eachword.click(\n                    function () {\n                        //if we are in spotcheck mode just return, we do not grade\n                        if (that.currentmode === 'spotcheck') {\n                            return;\n                        }\n\n                        //get the word that was clicked\n                        var wordnumber = $(this).attr('data-wordnumber');\n                        var theword = $(this).text();\n\n                        if (that.currentmode === 'transcriptcheck') {\n                            var chunk = that.fetchTranscriptChunk(wordnumber);\n                            if (chunk) {\n                                popoverhelper.addTranscript(this, chunk);\n                            }\n\n\n                        }\n                    });\n\n                //if not in review mode\n            } else {\n\n                //process word clicks\n                this.controls.eachword.click(\n                    function () {\n\n\n                        //get the word that was clicked\n                        var wordnumber = $(this).attr('data-wordnumber');\n                        var theword = $(this).text();\n\n                        //if we are in spotcheck mode lets enable quick grade popovers\n                        if (that.currentmode === 'spotcheck') {\n                            if ($(this).hasClass(that.cd.badwordclass) || $(this).hasClass(that.cd.aiunmatched)) {\n                                popoverhelper.addQuickGrader(this);\n                            }\n                            return;\n                        }\n\n                        if (that.currentmode === 'transcriptcheck') {\n                            var chunk = that.fetchTranscriptChunk(wordnumber);\n                            if (chunk) {\n                                popoverhelper.addTranscript(this, chunk);\n                            }\n                            return;\n                        }\n\n                        //this will disallow badwords after the endmarker\n                        if (that.options.enforcemarker && Number(wordnumber) > Number(that.options.endwordnumber)) {\n                            return;\n                        }\n\n                        if (wordnumber in that.options.errorwords) {\n                            delete that.options.errorwords[wordnumber];\n                            $(this).removeClass(that.cd.badwordclass);\n                        } else {\n                            that.adderrorword(wordnumber, theword);\n                            $(this).addClass(that.cd.badwordclass);\n                        }\n                        that.processscores();\n                    }\n                ); //end of each word click\n\n                //process space clicks\n                this.controls.eachspace.click(\n                    function () {\n\n                        //if we are in spotcheck or transcript check mode just return, we do not grade\n                        if (that.currentmode === 'spotcheck' || that.currentmode === 'transcriptcheck') {\n                            return;\n                        }\n\n                        //this event is entered by  click on space\n                        //it relies on attr data-wordnumber being set correctly\n                        var wordnumber = $(this).attr('data-wordnumber');\n                        var thespace = $('#' + that.cd.spaceclass + '_' + wordnumber);\n\n                        if (wordnumber === that.options.endwordnumber) {\n                            that.options.endwordnumber = that.options.totalwordcount;\n                            thespace.removeClass(that.cd.endspaceclass);\n                            $('#' + that.cd.spaceclass + '_' + that.options.totalwordcount).addClass(that.cd.endspaceclass);\n                        } else {\n                            $('#' + that.cd.spaceclass + '_' + that.options.endwordnumber).removeClass(that.cd.endspaceclass);\n                            that.options.endwordnumber = wordnumber;\n                            thespace.addClass(that.cd.endspaceclass);\n                        }\n                        that.processunread();\n                        that.processscores();\n                    }\n                );//end of each space click\n\n                //process clearbutton's click event\n                this.controls.clearbutton.click(function () {\n\n                    //if we are in spotcheck or transcript check mode just return, we do not grade\n                    if (that.currentmode === 'spotcheck' || that.currentmode === 'transcriptcheck') {\n                        return;\n                    }\n\n                    //clear all the error words\n                    $('.' + that.cd.badwordclass).each(function (index) {\n                        var wordnumber = $(this).attr('data-wordnumber');\n                        delete that.options.errorwords[wordnumber];\n                        $(this).removeClass(that.cd.badwordclass);\n                    });\n\n                    //remove unread words\n                    $('.' + that.cd.wordclass).removeClass(that.cd.unreadwordclass);\n\n                    //set endspace to last space\n                    that.options.endwordnumber = that.options.totalwordcount;\n                    $('.' + that.cd.spaceclass).removeClass(that.cd.endspaceclass);\n                    $('#' + that.cd.spaceclass + '_' + that.options.totalwordcount).addClass(that.cd.endspaceclass);\n\n                    //reprocess scores\n                    that.processscores();\n                });\n\n\n                //modebutton: turn on grading\n                this.controls.gradingbutton.click(function () {\n                    that.undoCurrentMode();\n                    that.doGradingMode();\n                    that.updateButtonStates();\n                });\n\n            }//end of if/else reviewmode\n\n            //either in or out of review mode we want these\n            //modebutton: turn on spotchecking\n            this.controls.spotcheckbutton.click(function () {\n                that.undoCurrentMode();\n                that.doSpotCheckMode();\n                that.updateButtonStates();\n            });\n\n            //modebutton: turn on transcript checking\n            this.controls.transcriptcheckbutton.click(function () {\n                that.undoCurrentMode();\n                that.doTranscriptCheckMode();\n                that.updateButtonStates();\n            });\n\n\n        },\n\n        undoCurrentMode: function () {\n            switch (this.currentmode) {\n                case 'grading':\n                    //we do not undo this, its the default\n                    break;\n                case 'spotcheck':\n                    this.undoSpotCheckMode();\n                    break;\n                case 'transcriptcheck':\n                    this.undoTranscriptCheckMode();\n                    break;\n            }\n\n        },\n\n        updateButtonStates: function () {\n            switch (this.currentmode) {\n                case 'grading':\n                    this.controls.gradingbutton.prop('disabled', true);\n                    this.controls.spotcheckbutton.prop('disabled', false);\n                    this.controls.transcriptcheckbutton.prop('disabled', false);\n                    break;\n                case 'spotcheck':\n                    this.controls.gradingbutton.prop('disabled', false);\n                    this.controls.spotcheckbutton.prop('disabled', true);\n                    this.controls.transcriptcheckbutton.prop('disabled', false);\n                    break;\n                case 'transcriptcheck':\n                    this.controls.gradingbutton.prop('disabled', false);\n                    this.controls.spotcheckbutton.prop('disabled', false);\n                    this.controls.transcriptcheckbutton.prop('disabled', true);\n                    break;\n            }\n\n        },\n\n        /*\n        * Here we fetch the playchain, start playing frm audiostart and add an event handler to stop at audioend\n         */\n        doPlaySpotCheck: function (spotcheckindex) {\n            var playchain = this.fetchPlayChain(spotcheckindex);\n            var theplayer = this.controls.audioplayer[0];\n            //we pad the play audio by 0.5 seconds beginning and end\n            var pad = 0.5;\n            var duration = theplayer.duration;\n            //determine starttime\n            var endtime = parseFloat(playchain.audioend);\n            if (!isNaN(duration) && duration > (endtime + pad)) {\n                endtime = endtime + pad;\n            }\n            //determine endtime\n            var starttime = parseFloat(playchain.audiostart);\n            if ((starttime - pad) > 0) {\n                starttime = starttime - pad;\n            }\n\n            theplayer.currentTime = starttime;\n            //we want to start and stop audio playback for spotcheck\n            //but do not want to overwrite any existing timeupdate event handlers\n            //so declare the callback and pass it to the on and off functions\n            var thecallback = function (e) {\n                var currenttime = theplayer.currentTime;\n                if (currenttime >= endtime) {\n                    $(this).off(\"timeupdate\",thecallback);\n                    theplayer.pause();\n                }\n            }\n            $(this.controls.audioplayer).off(\"timeupdate\", thecallback);\n            $(this.controls.audioplayer).on(\"timeupdate\", thecallback);\n            theplayer.play();\n        },\n\n        /*\n        * The playchain is all the words in a string of badwords.\n        * The complexity comes because a bad word  is usually one that isunmatched by AI.\n        * So if the teacher clicks on a passage word that did not appear in the transcript, what should we play?\n        * Answer: All the words from the last known to the next known word. Hence we create a play chain\n        * For consistency, if the teacher flags matched words as bad, while we do know their precise location we still\n        * make a play chain. Its not a common situation probably.\n         */\n        fetchPlayChain: function (spotcheckindex) {\n\n            //find startword\n            var startindex = spotcheckindex;\n            var starttime = -1;\n            for (var wordnumber = spotcheckindex; wordnumber > 0; wordnumber--) {\n                var isbad = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.badwordclass);\n                var isunmatched = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.aiunmatched);\n                //if current wordnumber part of the playchain, set it as the startindex.\n                // And get the audiotime if its a matched word. (we only know audiotime of matched words)\n                if (isbad || isunmatched) {\n                    startindex = wordnumber;\n                    if (!isunmatched) {\n                        starttime = this.options.sessionmatches['' + wordnumber].audiostart;\n                    } else {\n                        starttime = -1;\n                    }\n                } else {\n                    break;\n                }\n            }//end of for loop --\n            //if we have no starttime then we need to get the next matched word's audioend and use that\n            if (starttime === -1) {\n                starttime = 0;\n                for (var wordnumber = startindex - 1; wordnumber > 0; wordnumber--) {\n                    if (this.options.sessionmatches['' + wordnumber]) {\n                        starttime = this.options.sessionmatches['' + wordnumber].audioend;\n                        break;\n                    }\n                }\n            }\n\n            //find endword\n            var endindex = spotcheckindex;\n            var endtime = -1;\n            var passageendword = this.options.totalwordcount;\n            for (var wordnumber = spotcheckindex; wordnumber <= passageendword; wordnumber++) {\n                var isbad = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.badwordclass);\n                var isunmatched = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.aiunmatched);\n                //if its part of the playchain, set it to startindex. And get time if its a matched word.\n                if (isbad || isunmatched) {\n                    endindex = wordnumber;\n                    if (!isunmatched) {\n                        endtime = this.options.sessionmatches['' + wordnumber].audioend;\n                    } else {\n                        endtime = -1;\n                    }\n                } else {\n                    break;\n                }\n            }//end of for loop --\n            //if we have no endtime then we need to get the next matched word's audiostart and use that\n            if (endtime === -1) {\n                endtime = this.options.totalseconds;\n                for (var wordnumber = endindex + 1; wordnumber <= passageendword; wordnumber++) {\n                    if (this.options.sessionmatches['' + wordnumber]) {\n                        endtime = this.options.sessionmatches['' + wordnumber].audiostart;\n                        break;\n                    }\n                }\n            }\n            var playchain = {};\n            playchain.startword = startindex;\n            playchain.endword = parseInt(endindex);\n            playchain.audiostart = starttime;\n            playchain.audioend = parseInt(endtime);\n            //console.log('audiostart:' + starttime);\n            //console.log('audioend:' + endtime);\n\n            return playchain;\n\n        },\n\n        /*\n        * Here we mark up the passage for spotcheck mode. This will make up the spaces and the words as either badwords\n        * or aiunmatched words. We need to create playchains so aiunmatched still is indeicated visibly even where its\n        * not a badword (ie has been corrected)\n         */\n        doSpotCheckMode: function () {\n            var that = this;\n\n            //mark up all ai unmatched words as aiunmatched\n            this.markup_aiunmatchedwords();\n\n            //mark up all badwords as spotcheck words\n            $('.' + this.cd.badwordclass).addClass(this.cd.spotcheckmode);\n\n            //mark up spaces between spotcheck word and spotcheck/aiunmatched word (bad spaces)\n            //this.markup_badspaces();\n\n            //mark up spaces between aiunmatched word and spotcheck/aiunmatched word (aiunmatched spaces)\n            this.markup_aiunmatchedspaces();\n\n            this.currentmode = \"spotcheck\";\n        },\n\n        //mark up all ai unmatched words as aiunmatched\n        markup_aiunmatchedwords: function () {\n            var that = this;\n            if (this.options.sessionmatches) {\n                var prevmatch = 0;\n                $.each(this.options.sessionmatches, function (index, match) {\n                    var unmatchedcount = index - prevmatch - 1;\n                    if (unmatchedcount > 0) {\n                        for (var errorword = 1; errorword < unmatchedcount + 1; errorword++) {\n                            var wordnumber = prevmatch + errorword;\n                            $('#' + that.cd.wordclass + '_' + wordnumber).addClass(that.cd.aiunmatched);\n                        }\n                    }\n                    prevmatch = parseInt(index);\n                });\n\n                //mark all words from last matched word to the end as aiunmatched\n                for (var errorword = prevmatch + 1; errorword <= this.options.endwordnumber; errorword++) {\n                    $('#' + that.cd.wordclass + '_' + errorword).addClass(that.cd.aiunmatched);\n                }\n            }\n\n        },\n\n        //mark up spaces between spotcheck word and spotcheck/aiunmatched word (bad spaces)\n        /* NO LONGER USED  */\n        markup_badspaces: function () {\n            var that = this;\n            //mark up spaces between spotcheck word and spotcheck/aiunmatched word (bad spaces)\n            $('.' + this.cd.badwordclass + '.' + this.cd.spotcheckmode).each(function (index) {\n                var wordnumber = parseInt($(this).attr('data-wordnumber'));\n                //build chains (highlight spaces) of badwords or aiunmatched\n                if ($('#' + that.cd.wordclass + '_' + (wordnumber + 1)).hasClass(that.cd.spotcheckmode) ||\n                    $('#' + that.cd.wordclass + '_' + (wordnumber + 1)).hasClass(that.cd.aiunmatched)) {\n                    $('#' + that.cd.spaceclass + '_' + wordnumber).addClass(that.cd.spotcheckmode);\n                }\n            });\n        },\n\n        markup_aiunmatchedspaces: function () {\n            var that = this;\n            $('.' + this.cd.wordclass + '.' + this.cd.aiunmatched).each(function (index) {\n                var wordnumber = parseInt($(this).attr('data-wordnumber'));\n                //build chains (highlight spaces) of badwords or aiunmatched\n                if ($('#' + that.cd.wordclass + '_' + (wordnumber + 1)).hasClass(that.cd.spotcheckmode) ||\n                    $('#' + that.cd.wordclass + '_' + (wordnumber + 1)).hasClass(that.cd.aiunmatched)) {\n                    $('#' + that.cd.spaceclass + '_' + wordnumber).addClass(that.cd.aiunmatched);\n                }\n            });\n        },\n\n\n        undoSpotCheckMode: function () {\n            $('.' + this.cd.badwordclass).removeClass(this.cd.spotcheckmode);\n            $('.' + this.cd.spaceclass).removeClass(this.cd.spotcheckmode);\n            $('.' + this.cd.wordclass).removeClass(this.cd.aiunmatched);\n            $('.' + this.cd.spaceclass).removeClass(this.cd.aiunmatched);\n            $(this.controls.audioplayer).off(\"timeupdate\");\n            popoverhelper.remove();\n        },\n\n        /*\n       * Here we mark up the passage for transcriptcheck mode.\n        */\n        doTranscriptCheckMode: function () {\n            var that = this;\n            //mark up all ai unmatched words as transcriptcheck\n            if (this.options.sessionmatches) {\n                var prevmatch = 0;\n                $.each(this.options.sessionmatches, function (index, match) {\n                    var unmatchedcount = index - prevmatch - 1;\n                    if (unmatchedcount > 0) {\n                        for (var errorword = 1; errorword < unmatchedcount + 1; errorword++) {\n                            var wordnumber = prevmatch + errorword;\n                            $('#' + that.cd.wordclass + '_' + wordnumber).addClass(that.cd.aiunmatched);\n                        }\n                    }\n                    prevmatch = parseInt(index);\n                });\n\n                //mark all words from last matched word to the end as aiunmatched\n                for (var errorword = prevmatch + 1; errorword <= this.options.endwordnumber; errorword++) {\n                    $('#' + that.cd.wordclass + '_' + errorword).addClass(that.cd.aiunmatched);\n                }\n            }\n\n            //mark up spaces between aiunmatched word and aiunmatched (bad spaces)\n            $('.' + this.cd.aiunmatched).each(function (index) {\n                var wordnumber = parseInt($(this).attr('data-wordnumber'));\n                //build chains (highlight spaces) of badwords or aiunmatched\n                if ($('#' + that.cd.wordclass + '_' + (wordnumber + 1)).hasClass(that.cd.aiunmatched)) {\n                    $('#' + that.cd.spaceclass + '_' + wordnumber).addClass(that.cd.aiunmatched);\n                }\n            });\n\n            this.currentmode = \"transcriptcheck\";\n        },\n\n        undoTranscriptCheckMode: function () {\n            $('.' + this.cd.wordclass).removeClass(this.cd.aiunmatched);\n            $('.' + this.cd.spaceclass).removeClass(this.cd.aiunmatched);\n            popoverhelper.remove();\n        },\n\n        doGradingMode: function () {\n            this.currentmode = \"grading\";\n        },\n\n        /*\n       * This will take a wordindex and find the previous and next transcript indexes that were matched and\n       * return all the transcript words in between those.\n        */\n        fetchTranscriptChunk: function (checkindex) {\n\n            var transcriptlength = this.options.transcriptwords.length;\n            if (transcriptlength === 0) {\n                return \"\";\n            }\n\n            //find startindex\n            var startindex = -1;\n            for (var wordnumber = checkindex; wordnumber > 0; wordnumber--) {\n\n                var isunmatched = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.aiunmatched);\n                //if we matched then the subsequent transcript word is the last unmatched one in the checkindex sequence\n                if (!isunmatched) {\n                    startindex = this.options.sessionmatches['' + wordnumber].tposition + 1;\n                    break;\n                }\n            }//end of for loop\n\n            //find endindex\n            var endindex = -1;\n            for (var wordnumber = checkindex; wordnumber <= transcriptlength; wordnumber++) {\n\n                var isunmatched = $('#' + this.cd.wordclass + '_' + wordnumber).hasClass(this.cd.aiunmatched);\n                //if we matched then the previous transcript word is the last unmatched one in the checkindex sequence\n                if (!isunmatched) {\n                    endindex = this.options.sessionmatches['' + wordnumber].tposition - 1;\n                    break;\n                }\n            }//end of for loop --\n\n            //if there was no previous matched word, we set start to 1\n            if (startindex === -1) {\n                startindex = 1;\n            }\n            //if there was no subsequent matched word we flag the end as the -1\n            if (endindex === transcriptlength) {\n                endindex = -1;\n                //an edge case is where the first word is not in transcript and first match is the second or later passage\n                //word. It might not be possible for endindex to be lower than start index, but we don't want it anyway\n            } else if (endindex === 0 || endindex < startindex) {\n                return false;\n            }\n\n            //up until this point the indexes have started from 1, since the passage word numbers start from 1\n            //but the transcript array is 0 based so we adjust. array splice function does not include item and endindex\n            ///so it needs to be one more then start index. hence we do not adjust that\n            startindex--;\n\n            //finally we return the section\n            var ret = false;\n            if (endindex > 0) {\n                ret = this.options.transcriptwords.slice(startindex, endindex).join(\" \");\n            } else {\n                ret = this.options.transcriptwords.slice(startindex).join(\" \");\n            }\n            if (ret.trim() === '') {\n                return false;\n            } else {\n                return ret;\n            }\n        },\n\n\n        playword: function () {\n            var m = this;//M.mod_readaloud.gradenowhelper;\n            m.controls.wordplayer.attr('src', M.cfg.wwwroot + '/mod/readaloud/tts.php?txt=' + encodeURIComponent($(this).text())\n                + '&lang=' + m.options.ttslanguage + '&n=' + m.options.activityid);\n            m.controls.wordplayer[0].pause();\n            m.controls.wordplayer[0].load();\n            m.controls.wordplayer[0].play();\n        },\n        redrawgradestate: function () {\n            var m = this;\n            this.processunread();\n            if (this.options.reviewmode !== this.constants.REVIEWMODE_SCORESONLY) {\n                $.each(m.options.errorwords, function (index) {\n                        $('#' + m.cd.wordclass + '_' + m.options.errorwords[index].wordnumber).addClass(m.cd.badwordclass);\n                    }\n                );\n            }\n\n            this.markup_maybeselfcorrects();\n\n        },\n        adderrorword: function (wordnumber, word) {\n            this.options.errorwords[wordnumber] = {word: word, wordnumber: wordnumber};\n            //console.log(this.errorwords);\n\n        },\n        processword: function () {\n            var m = this;\n            var wordnumber = $(this).attr('data-wordnumber');\n            var theword = $(this).text();\n            //this will disallow badwords after the endmarker\n            if (m.options.enforcemarker && Number(wordnumber) > Number(m.options.endwordnumber)) {\n                return;\n            }\n\n            if (wordnumber in m.options.errorwords) {\n                delete m.options.errorwords[wordnumber];\n                $(this).removeClass(m.cd.badwordclass);\n            } else {\n                m.adderrorword(wordnumber, theword);\n                $(this).addClass(m.cd.badwordclass);\n            }\n            m.processscores();\n        },\n        //this function is never called it seems ....\n        processspace: function () {\n            //this event is entered by  click on space\n            //it relies on attr data-wordnumber being set correctly\n            var m = this;\n            var wordnumber = $(this).attr('data-wordnumber');\n            var thespace = $('#' + m.cd.spaceclass + '_' + wordnumber);\n\n            if (wordnumber === m.options.endwordnumber) {\n                m.options.endwordnumber = m.options.totalwordcount;\n                thespace.removeClass(m.cd.endspaceclass);\n                $('#' + m.cd.spaceclass + '_' + m.options.totalwordcount).addClass(m.cd.endspaceclass);\n            } else {\n                $('#' + m.cd.spaceclass + '_' + m.options.endwordnumber).removeClass(m.cd.endspaceclass);\n                m.options.endwordnumber = wordnumber;\n                thespace.addClass(m.cd.endspaceclass);\n            }\n            m.processunread();\n            m.processscores();\n        },\n\n        markup_maybeselfcorrects: function () {\n            var that = this;\n            if (this.options.sessionmatches) {\n                var prevmatch = false;\n                //loop through matches checking for insertions prior to matches\n                $.each(this.options.sessionmatches, function (index, match) {\n                    var maybe = false; // insertions exist between this match and prev match\n                    var verymaybe = false; //this word is matched and prev word is matched, but insertions exist\n\n                    if (prevmatch) {\n                        if (match.tposition - prevmatch.tposition > 1 && match.pposition - prevmatch.pposition === 1) {\n                            maybe = true;\n                            verymaybe = true;\n                        } else {\n                            if (match.tposition - prevmatch.tposition > 1) {\n                                maybe = true;\n                            }\n                        }\n                    } else if (prevmatch === false) {\n                        if (match.pposition < match.tposition) {\n                            maybe = true;\n                        }\n                    }\n                    //for now we will just work with very maybes, but we could do maybes\n                    if (verymaybe) {\n                        $('#' + that.cd.wordclass + '_' + match.pposition).addClass(that.cd.maybeselfcorrectclass);\n                    }\n                    prevmatch = match;\n                });\n            }\n        },\n\n        processunread: function () {\n            var m = this;\n            m.controls.eachword.each(function (index) {\n                var wordnumber = $(this).attr('data-wordnumber');\n                var thespace = $('#' + m.cd.spaceclass + '_' + wordnumber);\n\n                if (Number(wordnumber) > Number(m.options.endwordnumber)) {\n                    $(this).addClass(m.cd.unreadwordclass);\n                    thespace.addClass(m.cd.unreadspaceclass);\n\n                    //this will clear badwords after the endmarker\n                    if (m.options.enforcemarker && wordnumber in m.options.errorwords) {\n                        delete m.options.errorwords[wordnumber];\n                        $(this).removeClass(m.cd.badwordclass);\n                    }\n                } else {\n                    $(this).removeClass(m.cd.unreadwordclass);\n                    thespace.removeClass(m.cd.unreadspaceclass);\n                }\n            });\n        },\n        processscores: function () {\n            var m = this;\n            var errorscore = Object.keys(m.options.errorwords).length;\n            m.controls.errorscorebox.text(errorscore);\n\n            //wpm score\n            //we do not apply accuracy adjustment here, that is only for machine grades.\n            var wpmscore = 0;\n            var strictwpmscore = 0;\n            var totalwords=m.options.endwordnumber - errorscore;\n            if (m.options.totalseconds > 0) {\n\n                //regular WPM\n                wpmscore = Math.round((totalwords * 60) / m.options.totalseconds);\n\n                //strict WPM for grading\n                totalwords = totalwords - errorscore;\n                if(totalwords < 0){totalwords =0;}\n                strictwpmscore = Math.round((totalwords * 60) / m.options.totalseconds);\n            }\n            m.options.wpm = wpmscore;\n            m.controls.wpmscorebox.text(wpmscore);\n\n            //accuracy score\n            var accuracyscore = 0;\n            if (m.options.endwordnumber > 0) {\n                accuracyscore = Math.round((m.options.endwordnumber - errorscore) / m.options.endwordnumber * 100);\n            }\n            m.options.accuracy = accuracyscore;\n            m.controls.accuracyscorebox.text(accuracyscore);\n\n            //sessionscore\n            if(m.options.sessionscoremethod == m.constants.SESSIONSCORE_STRICT) {\n                var usewpmscore = strictwpmscore;\n            }else{\n                var usewpmscore = wpmscore;\n            }\n\n            if (usewpmscore > m.options.targetwpm) {\n                usewpmscore = m.options.targetwpm;\n            }\n            var sessionscore = Math.round(usewpmscore / m.options.targetwpm * 100);\n            m.controls.sessionscorebox.text(sessionscore);\n\n            //update form field\n            m.controls.formelementwpmscore.val(wpmscore);\n            m.controls.formelementsessionscore.val(sessionscore);\n            m.controls.formelementaccuracy.val(accuracyscore);\n            m.controls.formelementendword.val(m.options.endwordnumber);\n            m.controls.formelementerrors.val(JSON.stringify(m.options.errorwords));\n\n        }\n\n    };\n});"],"names":["define","$","log","def","popoverhelper","debug","controls","currentmode","constants","REVIEWMODE_NONE","REVIEWMODE_MACHINE","REVIEWMODE_HUMAN","REVIEWMODE_SCORESONLY","SESSIONSCORE_STRICT","cd","audioplayerclass","wordplayerclass","wordclass","spaceclass","badwordclass","endspaceclass","unreadwordclass","unreadspaceclass","wpmscoreid","accuracyscoreid","sessionscoreid","errorscoreid","formelementwpmscore","formelementaccuracy","formelementsessionscore","formelementendword","formelementtime","formelementerrors","modebutton","spotcheckbutton","transcriptcheckbutton","gradingbutton","clearbutton","spotcheckmode","aiunmatched","passagecontainer","maybeselfcorrectclass","selfcorrectclass","notesclass","structuralclass","meaningclass","visualclass","options","enabletts","targetwpm","ttslanguage","totalseconds","allowearlyexit","timelimit","enforcemarker","totalwordcount","wpm","accuracy","sessionscore","sessionscoremethod","endwordnumber","errorwords","activityid","attemptid","sesskey","init","config","theid","configcontrol","get","opts","JSON","parse","value","remove","register_controls","reviewmode","readonly","this","length","sessionmatches","aidata","transcriptwords","transcript","split","filter","el","redrawgradestate","addClass","register_events","m","processloadedaudio","sessiontime","audioplayer","duration","prop","isNaN","on","Math","round","val","processscores","init_popoverhelper","that","onReject","clickwordnumber","attr","playchain","fetchPlayChain","wordindex","startword","endword","theword","thespace","adderrorword","text","markup_aiunmatchedspaces","onAccept","removeClass","wordplayer","eachword","eachspace","endwordmarker","spotcheckword","wpmscorebox","accuracyscorebox","sessionscorebox","errorscorebox","wordnumber","parseInt","doPlaySpotCheck","click","Number","chunk","fetchTranscriptChunk","addTranscript","hasClass","addQuickGrader","processunread","each","index","undoCurrentMode","doGradingMode","updateButtonStates","doSpotCheckMode","doTranscriptCheckMode","undoSpotCheckMode","undoTranscriptCheckMode","spotcheckindex","theplayer","endtime","parseFloat","audioend","starttime","audiostart","currentTime","thecallback","e","off","pause","play","startindex","isbad","isunmatched","endindex","passageendword","markup_aiunmatchedwords","prevmatch","match","unmatchedcount","errorword","markup_badspaces","checkindex","transcriptlength","tposition","ret","slice","join","trim","playword","M","cfg","wwwroot","encodeURIComponent","load","markup_maybeselfcorrects","word","processword","processspace","verymaybe","pposition","errorscore","Object","keys","wpmscore","strictwpmscore","totalwords","accuracyscore","usewpmscore","stringify"],"mappings":"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"}