define(["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e","mod_wordcards/cardactions"],(function($,Ajax,Notification,ModalFactory,str,ModalEvents,a4e,cardactions){return{strings:{},init:function(opts){var that=this;this.init_strings();var theid="#"+opts.widgetid,propscontrol=$(theid).get(0);if(propscontrol){var props=JSON.parse(propscontrol.value);this.props=props,$(theid).remove();$(".event_flashcards"),$(".event_grid");var totalcards=$(".definition_flashcards_ul li").length;set_progress_info(1,totalcards),$("#Next").click((function(e){var cr_index=$(".is-current").index()+1;cr_index>totalcards-1&&(cr_index=0),$(".definition_flashcards_ul li").addClass("next-button-slide-is-leaving"),$(".definition_flashcards_ul li:eq("+cr_index+")").removeClass("slide-is-hidden").addClass("slide-is-visible next-button-slide-is-coming"),setTimeout((function(){$(".definition_flashcards_ul li").removeClass("is-current next-button-slide-is-leaving slide-is-visible").addClass("slide-is-hidden")}),500),setTimeout((function(){$(".definition_flashcards_ul li:eq("+cr_index+")").removeClass("slide-is-hidden next-button-slide-is-coming").addClass("slide-is-visible is-current")}),500),set_progress_info(cr_index+1,totalcards),cardactions.clearYouGlish(),cardactions.restoreCards(),cr_index+1===totalcards&&$("#Next").addClass("isLast"),cr_index+1>=1&&$("#Prev").removeClass("isFirst")})),$("#Prev").click((function(){var cr_index=$(".is-current").index()-1;cr_index<0&&(cr_index=totalcards-1),$(".definition_flashcards_ul li").addClass("prev-button-slide-is-leaving"),$(".definition_flashcards_ul li:eq("+cr_index+")").removeClass("slide-is-hidden").addClass("slide-is-visible prev-button-slide-is-coming");var curr_level_card=$(".curr_level_card").html();$(".curr_level_card").html(parseInt(curr_level_card)-1),set_progress_info(cr_index+1,totalcards),setTimeout((function(){$(".definition_flashcards_ul li").removeClass("is-current prev-button-slide-is-leaving slide-is-visible").addClass("slide-is-hidden")}),500),setTimeout((function(){$(".definition_flashcards_ul li:eq("+cr_index+")").removeClass("slide-is-hidden prev-button-slide-is-coming").addClass("slide-is-visible is-current")}),500),cardactions.clearYouGlish(),cardactions.restoreCards(),cr_index+1===0&&$("#Prev").addClass("isFirst")}));var container=$("#definitions-page-"+opts.widgetid),btn=(props.modid,props.canmanage,props.canattempt,$(".definitions-next"));a4e.register_events(),a4e.init_audio(props.token,props.region,props.owner),cardactions.init(props.youglish),container.on("click",".term-seen-action",(function(e){e.preventDefault();var termNode=$(this).parents(".term").first(),termId=termNode.data("termid");termNode.addClass("term-loading"),Ajax.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:termId}}])[0].then((function(result){if(!result)return $.Deferred().reject();$('.definition_flashcards [data-termid="'+termId+'"]').addClass("term-seen"),$('.definition_grid [data-termid="'+termId+'"]').addClass("term-seen")})).fail(Notification.exception).always((function(){termNode.removeClass("term-loading")}))})),btn.click((function(e){e.preventDefault();var buttonhref=$(this).data("href");"reattempt"===$(this).data("action")?ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:that.strings.reattempttitle,body:that.strings.reattemptbody}).then((function(modal){modal.setSaveButtonText(that.strings.reattempt),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=buttonhref})),modal.show()})):window.location.href=buttonhref}))}else log.debug("No config found on page. Giving up.");function set_progress_info(index,total){$(".definition_flashcards .wc_cardsprogress").text(index+" / "+total)}},init_strings:function(){var that=this;str.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done((function(s){var i=0;that.strings.reattempttitle=s[i++],that.strings.reattemptbody=s[i++],that.strings.reattempt=s[i++]}))}}}));

//# sourceMappingURL=definitions.min.js.map