{"version":3,"file":"a4e.min.js","sources":["../src/a4e.js"],"sourcesContent":["/**\n * Apps4EFL module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n  'jquery',\n  'core/log',\n  'core/ajax',\n  'mod_wordcards/flip',\n  'mod_wordcards/textfit',\n  'core/templates',\n  'mod_wordcards/pollyhelper',\n], function($, log, Ajax, flip, textFit, templates, polly) {\n\n  var a4e = {\n\n    face: true,\n\n    register_events: function() {\n      log.debug(\"register_events within a4e.js\");\n    },\n\n    init_audio: function(token, region, owner){\n\n      log.debug(\"a4e.js: initializing audio \");\n\n        //Init Polly TTS\n        polly.init(token, region, owner);\n\n        //play what was returned in polly.fetch_polly_url (callback)\n        polly.onnewpollyurl = function(theurl) {\n            var theplayer = $(\"#poodll_vocabplayer\");\n            theplayer.attr('src', theurl);\n            theplayer[0].play();\n        };\n\n        var playonclick = function(e) {\n\n              //if its a keydown event, only play if its enter or space\n              if(e.type==='keydown' && e.keyCode!==13 && e.keyCode!==32){\n                return;\n              }\n\n              e.preventDefault();\n              e.stopPropagation();\n\n              var theplayer = $(\"#poodll_vocabplayer\");\n\n              //if we have model audio use that, otherwise TTS\n              var audiourl=$(this).attr('data-modelaudio');\n              if(audiourl && (audiourl.indexOf('http:')===0 ||audiourl.indexOf('https:')===0)){\n                theplayer.attr('src', audiourl);\n                theplayer[0].play();\n              }else{\n                polly.fetch_polly_url($(this).attr('data-tts'), 'text', $(this).attr('data-ttsvoice'));\n              }\n            }\n\n        //register button event handlers to play audio\n        //flip cards / icons on learn cards / icons in vocab list / icons in learn list / icons in speech cards\n        //self select icons\n      var selectors = '.a4e-flashcards-container .play-tts';\n      selectors += ', .definitions-container .definition-play-tts';\n      selectors += ', #speech-container .wordcards-speechcards-speaker-icon';\n      selectors += ', .mod_wordcards_matching_frontbtn';\n      selectors += ', .model-sentence-play-tts';\n      selectors += ', #card-audio';\n      selectors += ', .selfselect-container .term-play-tts, .selfselect-container .model-sentence-play-tts';  \n      $(document.body).on('click', selectors, playonclick);\n      $(document.body).on('keydown', selectors, playonclick);\n\n        //cards on learn page\n      $('span.model-sentence-play-tts, #card-audio').on('click',playonclick );\n      $('span.model-sentence-play-tts, #card-audio').on('keydown',playonclick );\n    },\n\n    progress_dots: function(results, terms) {\n\n      var code = \"\",\n        color;\n      terms.forEach(function(o, i) {\n        var color = \"darkgray\";\n        if (results[i] !== undefined) {\n          if (results[i].points) {\n            color = \"green\";\n          } else {\n            color = \"red\";\n          }\n        }\n        code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n      });\n\n      $(\"#wordcards-progress-dots\").html(code);\n\n    },\n\n    shuffle: function(a) {\n      var j, x, i;\n      for (i = a.length; i; i -= 1) {\n        j = Math.floor(Math.random() * i);\n        x = a[i - 1];\n        a[i - 1] = a[j];\n        a[j] = x;\n      }\n    },\n    pretty_print_secs: function(time) {\n      var minutes = Math.floor(time / 60);\n      var seconds = time - minutes * 60;\n      return a4e.str_pad_left(minutes, '0', 2) + ':' + a4e.str_pad_left(seconds, '0', 2);\n    },\n\n    list_selfselect: function(target, terms) {\n\n      //template data\n      var tdata = [];\n      tdata['terms'] = terms;\n      templates.render('mod_wordcards/selfselect', tdata).then(\n        function(html, js) {\n          $(target).html(html);\n        }\n      );\n\n    },\n\n    list_vocab: function(target, terms, frontfaceflip) {\n\n      //template data\n      var tdata = [];\n      tdata['terms'] = terms;\n      templates.render('mod_wordcards/vocablist', tdata).then(\n        function(html, js) {\n          $(target).html(html);\n\n          var cards = $(\".a4e-flashcards-container .a4e-card\");\n          var faces = $(\".front,.back\");\n\n          setTimeout(function() {\n            cards.flip({axis:'x'});\n            textFit(faces, {\n              multiLine: true,\n              maxFontSize: 50,\n              alignHoriz: true,\n              alignVert: true\n            });\n          }, 100);\n\n          $('.a4e-flashcards-container .mod_wordcards_matching_frontbtn').on('click', function() {\n            $(\".a4e-flashcards-container .a4e-card\").flip(a4e.face);\n            a4e.face = !a4e.face;\n          });\n\n        }\n      );\n\n    },\n    calc_total_points: function(results) {\n      var total = 0;\n      $.each(results, function(i, o) {\n        if (o.points != undefined) {\n          total += o.points;\n        }\n      });\n      return total;\n    },\n    basic_feedback: function(results) {\n\n      var total = 0;\n      var total_time = 0;\n\n      $.each(results, function(i, o) {\n        if (o.time != null) {\n          total_time += o.time;\n        }\n        if (o.points != undefined) {\n          total += o.points;\n        }\n      });\n      var code = \"<div class='a4e-basic_feedback'><h2>\";\n      code += \"<i class='fa fa-trophy'></i> \" + total + \" points\";\n      if (total_time != 0) {\n        code += \"<hr/><i class='fa fa-clock-o'></i> \" + a4e.pretty_print_secs(total_time)\n      };\n      code += \"</h2></div>\";\n      return code;\n\n    },\n    detailed_feedback: function(results) {\n\n      var code = \"<div style='text-align:center;'>\",\n        color;\n\n      $.each(results, function(i, o) {\n\n        color = \"\";\n\n        if (o.points > 0) {\n          color = \"a4e-correct\";\n        } else {\n          color = \"a4e-incorrect\";\n        }\n\n        code += \"<div class='a4e-detailed_feedback_div \" + color + \"'>\";\n        code += \"<h3 style='margin-bottom:10px;margin-top:5px;'>\" + (i + 1) + \"</h3>\";\n        $.each(o, function(k, v) {\n          if (k == \"time\") {\n            code += \"<p><strong>\" + a4e.ucfirst(k) + \"</strong>:<br/>\" + a4e.pretty_print_secs(v) + \"</p>\";\n          } else {\n            code += \"<p><strong>\" + a4e.ucfirst(k) + \"</strong>:<br/>\" + (v == \"\" ? \"N/A\" : v) + \"</p>\";\n          }\n        });\n        code += \"</div>\";\n      });\n\n      code += \"</div>\";\n\n      return code;\n\n    },\n\n    str_pad_left: function(string, pad, length) {\n      return (new Array(length + 1).join(pad) + string).slice(-length);\n    },\n\n    ucfirst: function(str) {\n      str += ''\n      var f = str.charAt(0).toUpperCase()\n      return f + str.substr(1)\n    }\n\n  };\n\n  return a4e;\n\n});"],"names":["define","$","log","Ajax","flip","textFit","templates","polly","a4e","face","register_events","debug","init_audio","token","region","owner","init","onnewpollyurl","theurl","theplayer","attr","play","playonclick","e","type","keyCode","preventDefault","stopPropagation","audiourl","this","indexOf","fetch_polly_url","selectors","document","body","on","progress_dots","results","terms","code","forEach","o","i","color","undefined","points","html","shuffle","a","j","x","length","Math","floor","random","pretty_print_secs","time","minutes","seconds","str_pad_left","list_selfselect","target","tdata","render","then","js","list_vocab","frontfaceflip","cards","faces","setTimeout","axis","multiLine","maxFontSize","alignHoriz","alignVert","calc_total_points","total","each","basic_feedback","total_time","detailed_feedback","k","v","ucfirst","string","pad","Array","join","slice","str","charAt","toUpperCase","substr"],"mappings":"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"}