{"version":3,"file":"speechcards.min.js","sources":["../src/speechcards.js"],"sourcesContent":["/**\n * Matching module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n *\n */\n\ndefine([\n  'jquery',\n  'core/ajax',\n  'core/log',\n  'mod_wordcards/a4e',\n  'mod_wordcards/cloudpoodllloader',\n  'mod_wordcards/ttrecorder',\n  'core/templates',\n  'mod_wordcards/animatecss',\n], function($, Ajax, log, a4e, cloudpoodll, ttrecorder, templates, anim) {\n\n  var app = {\n    passmark: 75,\n    pointer: 1,\n    jsondata: null,\n    props: null,\n    dryRun: false,\n    controls: {},\n    region: 'useast1',\n    ttrec: null, //a handle on the tt recorder\n\n    init: function(props) {\n\n      //pick up opts from html\n      var theid = '#' + props.widgetid;\n      this.dryRun = props.dryRun;\n      this.nexturl = props.nexturl;\n      this.modid = props.modid;\n      this.region = props.region;\n      this.isFreeMode = props.isfreemode;\n      this.cardface = props.cardface;\n      var definitionscontrol = $(theid).get(0);\n      if (definitionscontrol) {\n        var jsondata = JSON.parse(definitionscontrol.value);\n        $(theid).remove();\n      } else {\n        //if there is no config we might as well give up\n        log.debug('No config found on page. Giving up.');\n        return;\n      }\n\n    //anim\n     var animopts = {};\n     animopts.useanimatecss=props.useanimatecss;\n     anim.init(animopts);\n\n      app.jsondata = jsondata;\n      app.props = props;\n      app.process(jsondata);\n\n\n\n      a4e.register_events();\n      a4e.init_audio(props.token,props.region,props.owner);\n\n      this.init_controls();\n      this.register_events();\n    },\n    init_controls: function() {\n      app.controls.close_results = $(\"#wordcards-close-results\");\n      app.controls.results = $(\"#wordcards-results\");\n      app.controls.vocab_list = $(\"#wordcards-vocab-list\");\n      app.controls.the_list = $(\"#speechcards_thelist\");\n      app.controls.gameboard = $(\"#wordcards-gameboard\");\n      app.controls.time_counter = $(\"#wordcards-time-counter\");\n      app.controls.prev_button = $(\".wordcards-speechcards_prevbutton\");\n      app.controls.next_button = $(\".wordcards-speechcards_nextbutton\");\n      app.controls.standalonepushrecorder = $(\".speechcards_standalonerecorder\");\n      app.controls.slider = $(\".wordcards-poodllspeechcards_box\");\n      app.controls.speakericon = $(\".wordcards-speechcards-speaker-icon\");\n    },\n    do_next: function() {\n      a4e.progress_dots(app.results, app.terms);\n      app.clearStarRating();\n      if (!app.is_end()) {\n        app.move_card('>');\n        app.update_header();\n      } else {\n        app.do_end();\n      }\n    },\n    do_prev: function() {\n      app.move_card('<');\n      app.update_header();\n    },\n\n    move_card: function(direction){\n        switch(direction){\n            case '<':\n                app.set_pointer(app.pointer - 1);\n                anim.do_animate(app.controls.slider,'zoomOut animate__faster','out').then(\n                    function(){\n                        app.setCardData(app.terms[app.pointer - 1]);\n                        anim.do_animate(app.controls.slider,'zoomIn animate__faster','in');\n                    }\n                );\n           /*\n                app.controls.slider.slideUp(400,\n                    function(){\n                        app.controls.slider.text(app.terms[app.pointer - 1].term);\n                        app.controls.slider.slideDown();\n                    }\n                );\n             */\n                app.update_header();\n                break;\n            case '>':\n            default:\n                app.set_pointer(app.pointer + 1);\n                anim.do_animate(app.controls.slider,'zoomOut animate__faster','out').then(\n                    function(){\n                        app.setCardData(app.terms[app.pointer - 1]);\n                        anim.do_animate(app.controls.slider,'zoomIn animate__faster','in');\n                    }\n                );\n                app.update_header();\n        }\n    },\n\n    clearStarRating:function(){\n      $(\"#wordcards-star-rating\").html('· · ·');\n    },\n    \n    register_events: function() {\n\n      app.controls.prev_button.click(function() {\n        app.do_prev();\n      });\n      app.controls.next_button.click(function() {\n\n        //user has given up tryint pronounce it,update word as failed\n        var failedword = app.terms[app.pointer - 1].term;\n        app.check(false, failedword);\n        app.do_next();\n\n      });\n\n      $('body').on('click', \"#wordcards-close-results\", function() {\n\n        var total_time = app.timer.count;\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\n        window.location.replace(url);\n\n      });\n\n      $('body').on('click', \"#wordcards-try-again\", function() {\n        location.reload();\n      });\n\n      $('body').on('click', '#wordcards-start-button', function() {\n        app.start();\n        log.debug('start button clicked');\n      });\n\n    },\n\n    process: function(jsondata) {\n\n      app.terms = jsondata.terms;\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\n\n      //init components\n      this.initComponents();\n\n    },\n\n    set_pointer:  function (newpointer) {\n        app.pointer = newpointer;\n    },\n\n    initCards: function() {\n        var theterm = app.terms[app.pointer - 1];\n        app.setCardData(theterm);\n    },\n\n    setCardData: function(theterm) {\n        var cardtext = app.cardface == 'term' ? theterm.term : theterm.model_sentence;\n        var cardaudio = app.cardface == 'term' ? theterm.audio : theterm.model_sentence_audio;\n        app.controls.slider.text(cardtext);\n        app.ttrec.currentPrompt=cardtext;\n\n        //set speaker icon attributes (a4e.js will play them if clicked)\n        app.controls.speakericon.attr('data-modelaudio',cardaudio);\n        app.controls.speakericon.attr('data-tts',cardtext);\n        app.controls.speakericon.attr('data-ttsvoice',theterm.ttsvoice);\n    },\n\n    initComponents: function() {\n\n      var that =this;\n\n      //The logic here is that on correct we transition.\n      //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n      var theCallback = function(message) {\n        //console.log(\"triggered callback\");\n        console.log(message);\n\n        switch (message.type) {\n          case 'recording':\n\n            break;\n\n          case 'speech':\n            var speechtext = message.capturedspeech;\n            var cleanspeechtext = app.cleanText(speechtext);\n            \n            var spoken = cleanspeechtext;\n            var correct =  app.cardface == 'term' ? app.terms[app.pointer - 1].term : app.terms[app.pointer - 1].model_sentence;\n\n            //Similarity check by character matching\n            var similarity = app.similarity(spoken,correct);\n            log.debug('JS similarity: ' + spoken + ':' + correct +':' + similarity);\n\n            //Similarity check by direct-match/acceptable-mistranscription\n            if (similarity >= app.passmark ||\n                app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1]) ) {\n                log.debug('local match:' + ':' + spoken +':' + correct);\n                  app.showStarRating(100);\n                  app.flagCorrectAndTransition(app.terms[app.pointer - 1]);\n                  return;\n            }\n\n            //Similarity check by phonetics(ajax)\n            app.checkByPhonetic(spoken,correct).then(function(similarity) {\n              if (similarity===false) {\n                  return $.Deferred().reject();\n              }else{\n                  log.debug('PHP similarity: ' + spoken + ':' + correct +':' + similarity);\n                  app.showStarRating(similarity);\n                  if(similarity>=app.passmark) {\n                      app.flagCorrectAndTransition(similarity, app.terms[app.pointer - 1]);\n                  }\n              }//end of if check_by_phonetic result\n             });//end of check by phonetic\n\n        }//end of switch message type\n      };\n\n      //init the recorder\n        var recid= 'wordcards-speechcards_pushrecorder';\n        //init tt recorder\n        var opts = {};\n        opts.uniqueid = recid;\n        opts.stt_guided = that.props.stt_guided;\n        opts.callback = theCallback;\n        app.ttrec = ttrecorder.clone();\n        app.ttrec.init(opts);\n        //init prompt for first card\n        //in some cases ttrecorder wants to know the target\n        app.ttrec.currentPrompt=app.terms[app.pointer - 1]['term'];\n    },\n\n    showStarRating: function(similarity){\n        //how many stars code\n        var stars = [true,true,true];\n        if(similarity<1){\n            stars=[true,true,false];\n        }\n        if(similarity<app.passmark){\n            stars=[true,false,false];\n        }\n        if(similarity<0.5){\n            stars=[false,false,false];\n        }\n        console.log(stars,similarity);\n\n        //prepare stars html\n        var code=\"\";\n        stars.forEach(function(star){\n            if(star===true){\n                code+='<i class=\"fa fa-star\"></i>';\n            }\n            else{\n                code+='<i class=\"fa fa-star-o\"></i>';\n            }\n        });\n        console.log(code);\n        $(\"#wordcards-star-rating\").html(code);\n    },\n\n    flagCorrectAndTransition: function(term){\n\n        //update students word log if matched\n        app.check(true, term);\n\n        //transition if required\n        if (app.is_end()) {\n            app.update_header();\n            setTimeout(function() {\n                app.do_end();\n            }, 700);\n        } else {\n            setTimeout(function() {\n                app.do_next();\n            }, 700);\n        }\n\n    },\n\n    //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n    checkByPhonetic: function(spoken, correct){\n\n      return Ajax.call([{\n            'methodname': 'mod_wordcards_check_by_phonetic',\n            'args': {\n                'spoken': spoken,\n                'correct': correct,\n                'language': app.props.language,\n            }\n        }])[0];\n\n    },\n\n    wordsDoMatch: function(wordheard, currentterm) {\n      //lets lower case everything\n      wordheard = app.cleanText(wordheard);\n      correcttext = app.cardface=='term' ? currentterm.term : currentterm.model_sentence;\n      correcttext = app.cleanText(correcttext);\n      if (wordheard == correcttext) {\n        return true;\n      }\n      if (!currentterm.alternates || app.cardface=='term') {\n        return false;\n      }\n      var awords = currentterm.alternates.split(',');\n      var matched = false;\n      $.each(awords, function(i, word) {\n        if (app.cleanText(word.toLowerCase()) == wordheard) {\n          //we return false to break out of the loop, not to tell the parent its unmatched\n          matched = true;\n          return false;\n        }\n      });\n      return matched;\n    },\n\n    cleanText: function(text) {\n        var lowertext = text.toLowerCase();\n        var punctuationless = lowertext.replace(/['!\"#$%&\\\\'()\\*+,\\-\\.\\/:;<=>?@\\[\\\\\\]\\^_`{|}~']/g,\"\");\n        var ret = punctuationless.replace(/\\s+/g, \" \").trim();\n        return ret;\n    },\n\n    start: function() {\n      app.results = [];\n      a4e.shuffle(app.terms);\n      app.controls.vocab_list.hide();\n      app.controls.gameboard.show();\n      app.controls.time_counter.text(\"00:00\");\n      app.clearStarRating();\n      a4e.progress_dots(app.results, app.terms);\n      app.timer = {\n        interval: setInterval(function() {\n          app.timer.update();\n        }, 1000),\n        count: 0,\n        update: function() {\n          app.timer.count++;\n          app.controls.time_counter.text(a4e.pretty_print_secs(app.timer.count));\n        }\n      }\n      app.update_header();\n      app.initCards();\n    },\n    quit: function() {\n      clearInterval(app.timer.interval);\n      app.controls.gameboard.hide();\n      app.controls.vocab_list.show();\n    },\n\n    do_end: function() {\n      clearInterval(app.timer.interval);\n      $(\"#wordcards-gameboard, #wordcards-quit-button, #wordcards-start-button\").hide();\n      $(\"#wordcards-results\").show();\n\n      //template data\n      var tdata = [];\n      tdata['nexturl'] = this.nexturl;\n      tdata['results'] = app.results;\n      tdata['total'] = app.terms.length;\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\n      var total_time = app.timer.count;\n      if (total_time == 0) {\n        tdata['prettytime'] = '00:00';\n      } else {\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\n      }\n      templates.render('mod_wordcards/feedback', tdata).then(\n        function(html, js) {\n          $(\"#results-inner\").html(html);\n            // Add listeners for the \"Add to my words\" buttons.\n            require([\"mod_wordcards/mywords\"], function(mywords) {\n                mywords.initFromFeedbackPage();\n            });\n        }\n      );\n\n      var data = {\n        results: app.results,\n        activity: \"speechcards\"\n      };\n      console.log(data);\n\n    if (!app.isFreeMode) {\n        Ajax.call([{\n            methodname: 'mod_wordcards_report_step_grade',\n            args: {\n                modid: app.modid,\n                correct: tdata['totalcorrect']\n            }\n        }]);\n    }\n    },\n\n    is_end: function() {\n      if (app.pointer < app.terms.length) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n\n    update_header: function() {\n\n      var progress = {\n        correct: app.results.filter(function(e) {\n          return e.points > 0\n        }).length / app.terms.length * 100,\n        incorrect: app.results.filter(function(e) {\n          return e.points == 0\n        }).length / app.terms.length * 100\n      }\n\n    },\n\n    check: function(correct, spokenwords) {\n      var points = 1;\n      if (correct == true) {\n        //createjs.Sound.play('correct');\n        points = 1;\n      } else {\n        points = 0;\n        //createjs.Sound.play('incorrect');\n      }\n      $(\".a4e-distractor\").css('pointer-events', 'none');\n      var result = {\n        pointer: app.pointer,\n        question: app.terms[app.pointer - 1]['definition'],\n        selected: spokenwords,\n        correct: app.terms[app.pointer - 1]['term'],\n        points: points,\n        id: app.terms[app.pointer - 1]['id']\n      };\n\n      $.each(app.results, (function(result) {\n        if (app.pointer === result.pointer) {\n          //something here to remove the old result\n        }\n      }));\n      //finally add our result to the results\n      app.results.push(result);\n\n      //post results to server\n      if (correct) {\n        this.reportSuccess(app.terms[app.pointer - 1]['id']);\n      } else {\n        this.reportFailure(app.terms[app.pointer - 1]['id'], 0);\n      }\n\n    },\n\n    reportFailure: function(term1id, term2id) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_failed_association',\n        args: {\n          term1id: term1id,\n          term2id: term2id,\n          isfreemode: app.isFreeMode\n        }\n      }]);\n    },\n\n    reportSuccess: function(termid) {\n      if (this.dryRun) {\n        return;\n      }\n\n      Ajax.call([{\n        methodname: 'mod_wordcards_report_successful_association',\n        args: {\n          termid: termid,\n          isfreemode: app.isFreeMode\n        }\n      }]);\n    },\n\n    similarity: function(s1, s2) {\n      var longer = s1;\n      var shorter = s2;\n      if (s1.length < s2.length) {\n        longer = s2;\n        shorter = s1;\n      }\n      var longerLength = longer.length;\n      if (longerLength == 0) {\n        return 1.0;\n      }\n      return (longerLength - app.editDistance(longer, shorter)) / parseFloat(longerLength);\n    },\n    editDistance: function(s1, s2) {\n      s1 = s1.toLowerCase();\n      s2 = s2.toLowerCase();\n\n      var costs = new Array();\n      for (var i = 0; i <= s1.length; i++) {\n        var lastValue = i;\n        for (var j = 0; j <= s2.length; j++) {\n          if (i == 0)\n            costs[j] = j;\n          else {\n            if (j > 0) {\n              var newValue = costs[j - 1];\n              if (s1.charAt(i - 1) != s2.charAt(j - 1))\n                newValue = Math.min(Math.min(newValue, lastValue),\n                  costs[j]) + 1;\n              costs[j - 1] = lastValue;\n              lastValue = newValue;\n            }\n          }\n        }\n        if (i > 0)\n          costs[s2.length] = lastValue;\n      }\n      return costs[s2.length];\n    },\n\n      mobile_user: function() {\n\n          if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n              return true;\n          } else {\n              return false;\n          }\n      },\n\n      chrome_user: function(){\n          if(/Chrome/i.test(navigator.userAgent)) {\n              return true;\n          }else{\n              return false;\n          }\n      }\n\n  };\n\n  return app;\n\n\n});"],"names":["define","$","Ajax","log","a4e","cloudpoodll","ttrecorder","templates","anim","app","passmark","pointer","jsondata","props","dryRun","controls","region","ttrec","init","theid","widgetid","nexturl","modid","isFreeMode","isfreemode","cardface","definitionscontrol","get","JSON","parse","value","remove","animopts","useanimatecss","process","register_events","init_audio","token","owner","init_controls","debug","close_results","results","vocab_list","the_list","gameboard","time_counter","prev_button","next_button","standalonepushrecorder","slider","speakericon","do_next","progress_dots","terms","clearStarRating","is_end","do_end","move_card","update_header","do_prev","direction","set_pointer","do_animate","then","setCardData","html","click","failedword","term","check","on","total_time","timer","count","url","replace","window","location","reload","start","list_vocab","initComponents","newpointer","initCards","theterm","cardtext","model_sentence","cardaudio","audio","model_sentence_audio","text","currentPrompt","attr","ttsvoice","opts","stt_guided","this","callback","message","console","type","speechtext","capturedspeech","cleanspeechtext","cleanText","spoken","correct","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","Deferred","reject","clone","stars","code","forEach","star","setTimeout","call","language","wordheard","currentterm","correcttext","alternates","awords","split","matched","each","i","word","toLowerCase","trim","shuffle","hide","show","interval","setInterval","update","pretty_print_secs","quit","clearInterval","tdata","length","calc_total_points","render","js","require","mywords","initFromFeedbackPage","data","activity","methodname","args","filter","e","points","spokenwords","css","result","question","selected","id","push","reportSuccess","reportFailure","term1id","term2id","termid","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","costs","Array","lastValue","j","newValue","charAt","Math","min","mobile_user","test","navigator","userAgent","chrome_user"],"mappings":"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"}