define(["jquery","core/log","core/ajax","core/templates"],(function($,log,ajax,templates){return log.debug("Wordcards dictionary lookup: initialising"),{init:function(cmid,modid,resultscont){log.debug("Wordcards dictionary lookup: initialising"),this.cmid=cmid,this.modid=modid,this.resultscont=resultscont},update_page:function(alldata){var that=this;that.resultscont.empty();for(var i=0;i<alldata.length;i++){var tdata=alldata[i];templates.render("mod_wordcards/word_wizard_oneresult",tdata).then((function(html,js){that.resultscont.append(html),templates.runTemplateJS(js)}))}},replace_placeholder_with_result:function(placeholder,termdata){templates.render("mod_wordcards/word_wizard_oneresult",termdata).then((function(html,js){placeholder.replaceWith(html),templates.runTemplateJS(js)}))},getwords:async function(allwords,sourcelang,definitionslang){var that=this,searchbtn=$(".ww_words_fetch_btn");if(""===allwords.trim())return!1;that.resultscont.empty();for(var requests=[],templatepromises=[],wordarray=allwords.split(","),i=0;i<wordarray.length;i++){var word=wordarray[i].trim();if(""!==word){requests.push({methodname:"mod_wordcards_search_dictionary",args:{terms:word,cmid:that.cmid,sourcelang:sourcelang,targetlangs:definitionslang},async:!0});let tdata={term:word,termno:requests.length-1};templatepromises.push(templates.render("mod_wordcards/ww_skeleton",tdata))}}var searchbtncontent=searchbtn.html();searchbtn.html('<i class="icon fa fa-spinner fa-spin fa-fw"></i>'),await Promise.all(templatepromises).then((results=>{results.forEach((html=>{that.resultscont.append(html)}))})),searchbtn.html(searchbtncontent);for(let reqindex=0;reqindex<requests.length;reqindex++)ajax.call([requests[reqindex]],!0)[0].then((response=>{log.debug("placeholder - #mod_wordcards_wwskeleton_"+reqindex);var placeholder=$("#mod_wordcards_wwskeleton_"+reqindex);0===response.success&&log.debug(response.payload);for(var terms=JSON.parse(response.payload),i=0;i<terms.length;i++){var theterm=terms[i];if(0===theterm.count||0===theterm.results.length){var senses=[];senses.push({definition:"No definition",sourcedefinition:"No definition",modelsentence:"",senseindex:0,translations:"{}"});var tdata={term:theterm.term,senses:senses,modid:that.modid};that.replace_placeholder_with_result(placeholder,tdata)}else{tdata={term:theterm.term,senses:[],modid:that.modid};for(var sindex in theterm.results){var sense=theterm.results[sindex],sourcedefinition=sense.definition,alltrans={};for(var langkey in sense)sense.hasOwnProperty(langkey)&&langkey.startsWith("lang_")&&(alltrans[langkey.substring(5)]=sense[langkey]);var translations=JSON.stringify(alltrans),definition=sourcedefinition;log.debug("definitionslang: "+definitionslang),"en"!==definitionslang?definition=sense.hasOwnProperty("lang_"+definitionslang)?sense["lang_"+definitionslang]:"No translation available":sense.hasOwnProperty("meaning")?definition=sense.meaning:sense.hasOwnProperty("lang_en")?definition=sense.lang_en:""==definition&&(definition="No translation available");var modelsentence=sense.example;tdata.senses.push({definition:definition,sourcedefinition:sourcedefinition,modelsentence:modelsentence,senseindex:sindex,translations:translations})}that.replace_placeholder_with_result(placeholder,tdata)}}}))}}}));

//# sourceMappingURL=dictlookup.min.js.map