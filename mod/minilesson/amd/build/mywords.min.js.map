{"version":3,"file":"mywords.min.js","sources":["../src/mywords.js"],"sourcesContent":["/**\n * Module to watch my words buttons for clicks and report to back end.\n *\n * @package mod_minilesson\n * @author David Watson - evolutioncode.uk\n */\ndefine(['jquery', 'core/ajax', 'core/str'], function($, ajax, str) {\n    const SELECTOR = {\n        DATA_SET: '*[data-action=\"minilesson-set-my-words\"]',\n        MY_WORDS_DIV: '#my-words-ids',\n        MY_WORDS_ACTION_BTN_ID: '.minilesson-mywords-action-',\n        WORDPOOL_COUNTS: '.wordpool-count'\n    }\n\n    const CLASS = {\n        DISABLED: 'disabled',\n        BTN_NOT_IN_MY_WORDS: 'btn-outline-primary',\n        BTN_IN_MY_WORDS: 'btn-primary'\n    }\n\n    const EVENT = {\n        CLICK: 'click',\n        KEYDOWN: 'keydown',\n    }\n\n    const DATA = {\n        TERM_ID: 'data-termid',\n        VALUE: 'data-value',\n        ADD: 'data-add',\n        REMOVE: 'data-remove',\n        MY_WORDS_IDS: 'data-my-words-term-ids'\n    }\n    var stringStore = {};\n\n    const initStrings = function (callback) {\n        str.get_strings([\n            {key: \"addtomywords\", component: \"mod_minilesson\"},\n            {key: \"removefrommywords\", component: \"mod_minilesson\"},\n        ]).done(function (strings) {\n            stringStore = strings;\n            if (typeof callback == 'function') {\n                callback();\n            }\n        });\n    }\n\n    const initButtonListeners = function() {\n        var doMyWords = function(e) {\n\n            //if its a keydown event, only respond if its enter or space\n            if(e.type==='keydown' && e.keyCode!==13 && e.keyCode!==32){\n                return;\n            }\n\n            e.stopPropagation();\n\n            // There are two buttons for each term (one in grid and one in flashcards).\n            const currTar = $(e.currentTarget);\n            const buttons = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + currTar.attr(DATA.TERM_ID));\n            const termId = buttons.attr(DATA.TERM_ID);\n            if (!currTar.hasClass(CLASS.DISABLED)) {\n                e.preventDefault();\n                buttons.addClass(CLASS.DISABLED)\n                // Hide wordpool counts in drop down as may become incorrect here.\n                $(SELECTOR.WORDPOOL_COUNTS).fadeOut();\n                const newStatus = buttons.hasClass(CLASS.BTN_IN_MY_WORDS) ? 0 : 1;\n                ajax.call([{\n                    methodname: 'mod_minilesson_set_my_words', // TODO: Look at this.\n                    args: {\n                        termid: termId,\n                        newstatus: newStatus\n                    }\n                }])[0].done(function(response) {\n                    if (response.success) {\n                        buttons.removeClass(CLASS.DISABLED);\n                        if (response.newStatus) {\n                            buttons.addClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.removeClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[1]);\n                        } else {\n                            buttons.removeClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.addClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[0]);\n                        }\n                    }\n                }).fail(function() {\n                    buttons.removeClass(CLASS.DISABLED);\n                })\n            }\n        };\n        $(SELECTOR.DATA_SET).on(EVENT.CLICK,doMyWords );\n        $(SELECTOR.DATA_SET).on(EVENT.KEYDOWN,doMyWords );\n    }\n\n    /**\n     * Existing button statuses are on the main freemode template markup, so we need to grab them and render them,\n     */\n    const applyButtonStatuses = function() {\n        const myWordsDiv = $(SELECTOR.MY_WORDS_DIV);\n        if (myWordsDiv) {\n            const ids = JSON.parse(myWordsDiv.attr(DATA.MY_WORDS_IDS));\n            ids.forEach((id) => {\n                const btn = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + id);\n                if (!btn.hasClass(CLASS.BTN_IN_MY_WORDS)) {\n                    btn\n                        .addClass(CLASS.BTN_IN_MY_WORDS)\n                        .removeClass(CLASS.BTN_NOT_IN_MY_WORDS)\n                        .attr('title', stringStore[1]);\n                }\n            });\n            return true;\n        }\n    }\n    return {\n        init: function () {\n            $(document).ready(function() {\n                initStrings();\n                initButtonListeners();\n            })\n        },\n        initFromFeedbackPage: function () {\n            initStrings(applyButtonStatuses);\n            initButtonListeners();\n        }\n    }\n});"],"names":["define","$","ajax","str","SELECTOR","CLASS","EVENT","DATA","stringStore","initStrings","callback","get_strings","key","component","done","strings","initButtonListeners","doMyWords","e","type","keyCode","stopPropagation","currTar","currentTarget","buttons","attr","termId","hasClass","preventDefault","addClass","fadeOut","newStatus","call","methodname","args","termid","newstatus","response","success","removeClass","fail","on","applyButtonStatuses","myWordsDiv","JSON","parse","forEach","id","btn","init","document","ready","initFromFeedbackPage"],"mappings":"AAMAA,gCAAO,CAAC,SAAU,YAAa,aAAa,SAASC,EAAGC,KAAMC,WACpDC,kBACQ,2CADRA,sBAEY,gBAFZA,gCAGsB,8BAHtBA,yBAIe,kBAGfC,eACQ,WADRA,0BAEmB,sBAFnBA,sBAGe,cAGfC,YACK,QADLA,cAEO,UAGPC,aACO,cADPA,kBAKY,6BAEdC,YAAc,SAEZC,YAAc,SAAUC,UAC1BP,IAAIQ,YAAY,CACZ,CAACC,IAAK,eAAgBC,UAAW,kBACjC,CAACD,IAAK,oBAAqBC,UAAW,oBACvCC,MAAK,SAAUC,SACdP,YAAcO,QACS,mBAAZL,UACPA,eAKNM,oBAAsB,eACpBC,UAAY,SAASC,MAGT,YAATA,EAAEC,MAAgC,KAAZD,EAAEE,SAA4B,KAAZF,EAAEE,eAI7CF,EAAEG,wBAGIC,QAAUrB,EAAEiB,EAAEK,eACdC,QAAUvB,EAAEG,gCAAkCkB,QAAQG,KAAKlB,eAC3DmB,OAASF,QAAQC,KAAKlB,kBACvBe,QAAQK,SAAStB,gBAAiB,CACnCa,EAAEU,iBACFJ,QAAQK,SAASxB,gBAEjBJ,EAAEG,0BAA0B0B,gBACtBC,UAAYP,QAAQG,SAAStB,uBAAyB,EAAI,EAChEH,KAAK8B,KAAK,CAAC,CACPC,WAAY,8BACZC,KAAM,CACFC,OAAQT,OACRU,UAAWL,cAEf,GAAGjB,MAAK,SAASuB,UACbA,SAASC,UACTd,QAAQe,YAAYlC,gBAChBgC,SAASN,WACTP,QAAQK,SAASxB,uBACjBmB,QAAQe,YAAYlC,2BACpBmB,QAAQC,KAAK,QAASjB,YAAY,MAElCgB,QAAQe,YAAYlC,uBACpBmB,QAAQK,SAASxB,2BACjBmB,QAAQC,KAAK,QAASjB,YAAY,SAG3CgC,MAAK,WACJhB,QAAQe,YAAYlC,qBAIhCJ,EAAEG,mBAAmBqC,GAAGnC,YAAYW,WACpChB,EAAEG,mBAAmBqC,GAAGnC,cAAcW,YAMpCyB,oBAAsB,iBAClBC,WAAa1C,EAAEG,0BACjBuC,WAAY,QACAC,KAAKC,MAAMF,WAAWlB,KAAKlB,oBACnCuC,SAASC,WACHC,IAAM/C,EAAEG,gCAAkC2C,IAC3CC,IAAIrB,SAAStB,wBACd2C,IACKnB,SAASxB,uBACTkC,YAAYlC,2BACZoB,KAAK,QAASjB,YAAY,QAGhC,UAGR,CACHyC,KAAM,WACFhD,EAAEiD,UAAUC,OAAM,WACd1C,cACAO,0BAGRoC,qBAAsB,WAClB3C,YAAYiC,qBACZ1B"}