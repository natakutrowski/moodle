{"version":3,"file":"ttspassage.min.js","sources":["../src/ttspassage.js"],"sourcesContent":["define(['jquery','core/log'], function($,log) {\n    \"use strict\"; // jshint ;_;\n\n\n    log.debug('MiniLesson TTS Passage: initialising');\n\n    return{\n\n        init: function(PASSAGEID){\n\n            //DECLARATIONS and INITs ...........................\n            var thesentence_number =0;\n            var lettered= false;\n            var stoporpause='pause';\n\n\n\n            //audio player declarations\n            var aplayer = $('#' + PASSAGEID + '_ttspassageaudio');\n            var thebutton = $('#' + PASSAGEID + '_ttspassagebutton');\n            var textblock = $('#' + PASSAGEID + '_textblock');\n            var fa = $('#' + PASSAGEID + '_ttspassagebutton .fa');\n\n            //some common selectors\n            var sentenceselector = '#' + PASSAGEID+ '_textblock span.tbr_sentence';\n            var passagelines = $(sentenceselector);\n\n            var numberSentences = function(){\n                var linecount = passagelines.length;\n                for (var thesentence=0; thesentence < linecount; thesentence++){\n                    $(passagelines[thesentence]).attr('data-sentenceindex',thesentence);\n                }//end of for loop\n            };\n\n            //FUNCTION:  unhighlight a sentence as active\n            var dehighlight_all = function(){\n                passagelines.removeClass('passageplayer_activesentence');\n            };\n\n            //FUNCTION:  highlight a sentence as active\n            var highlight_sentence = function(thesentence){\n                passagelines.removeClass('passageplayer_activesentence');\n                $(passagelines[thesentence]).addClass('passageplayer_activesentence');\n                // $(sentenceselector + '[data-sentenceindex=' + thesentence + ']').addClass('passageplayer_activesentence');\n            };\n\n            //FUNCTION: play a single sentence and mark it active for display purposes\n            var doplayaudio = function(thesentence){\n                log.debug(thesentence);\n                log.debug($(passagelines[thesentence]).data('audiourl'));\n                highlight_sentence(thesentence);\n                aplayer.attr('src',$(passagelines[thesentence]).data('audiourl'));\n                aplayer[0].play();\n            };\n\n\n            //AUDIO PLAYER events\n            aplayer[0].addEventListener('ended', function(){\n                if(thesentence_number< passagelines.length -1){\n                    thesentence_number++;\n                    doplayaudio(thesentence_number);\n                }else{\n                    dehighlight_all();\n                    fa.removeClass('fa-stop');\n                    fa.addClass('fa-volume-up');\n                    thesentence_number=0;\n                    aplayer.removeAttr('src');\n                }\n            });\n\n            //handle audio player button clicks\n            thebutton.click(function(){\n                if(!aplayer[0].paused && !aplayer[0].ended){\n                    aplayer[0].pause();\n                    if(stoporpause=='stop'){\n                        aplayer[0].load();\n                        thesentence_number=0;\n                    }\n                    fa.removeClass('fa-stop');\n                    fa.addClass('fa-volume-up');\n\n                    //if paused and in limbo no src state\n                }else if(aplayer[0].paused && aplayer.attr('src')){\n                    aplayer[0].play();\n                    fa.removeClass('fa-volume-up');\n                    fa.addClass('fa-stop');\n                    //play\n                }else{\n                    if(!lettered){\n                        //spanify_text_passage();\n                        lettered=true;\n                    }//end of if lettered\n                    if(stoporpause=='stop'){\n                        thesentence_number=0;\n                    }\n                    doplayaudio(thesentence_number);\n                    fa.removeClass('fa-volume-up');\n                    fa.addClass('fa-stop');\n                }//end of if paused ended\n            });\n\n            //handle sentence clicks\n            $('#' + PASSAGEID + '_textblock  .tbr_innerdiv').on('click', '.tbr_sentence',function(){\n                aplayer[0].pause();\n                var sentenceindex = $(this).attr('data-sentenceindex');\n                fa.removeClass('fa-volume-up');\n                fa.addClass('fa-stop');\n                thesentence_number = sentenceindex;\n                doplayaudio(sentenceindex);\n            });\n\n            //PROCEDURAL stuff\n            numberSentences();\n\n\n            //end of instance wrapper\n        }\n\n    };//end of return value\n});"],"names":["define","$","log","debug","init","PASSAGEID","thesentence_number","lettered","aplayer","thebutton","fa","passagelines","doplayaudio","thesentence","data","removeClass","addClass","highlight_sentence","attr","play","addEventListener","length","removeAttr","click","paused","ended","pause","on","sentenceindex","this","linecount","numberSentences"],"mappings":"AAAAA,mCAAO,CAAC,SAAS,aAAa,SAASC,EAAEC,YAIrCA,IAAIC,MAAM,wCAEJ,CAEFC,KAAM,SAASC,eAGPC,mBAAoB,EACpBC,UAAU,EAMVC,QAAUP,EAAE,IAAMI,UAAY,oBAC9BI,UAAYR,EAAE,IAAMI,UAAY,qBAEhCK,IADYT,EAAE,IAAMI,UAAY,cAC3BJ,EAAE,IAAMI,UAAY,0BAIzBM,aAAeV,EADI,IAAMI,UAAW,gCAuBpCO,YAAc,SAASC,aACvBX,IAAIC,MAAMU,aACVX,IAAIC,MAAMF,EAAEU,aAAaE,cAAcC,KAAK,aATvB,SAASD,aAC9BF,aAAaI,YAAY,gCACzBd,EAAEU,aAAaE,cAAcG,SAAS,gCAQtCC,CAAmBJ,aACnBL,QAAQU,KAAK,MAAMjB,EAAEU,aAAaE,cAAcC,KAAK,aACrDN,QAAQ,GAAGW,QAKfX,QAAQ,GAAGY,iBAAiB,SAAS,WAC9Bd,mBAAoBK,aAAaU,OAAQ,GACxCf,qBACAM,YAAYN,sBAxBhBK,aAAaI,YAAY,gCA2BrBL,GAAGK,YAAY,WACfL,GAAGM,SAAS,gBACZV,mBAAmB,EACnBE,QAAQc,WAAW,WAK3Bb,UAAUc,OAAM,WACRf,QAAQ,GAAGgB,QAAWhB,QAAQ,GAAGiB,MAU5BjB,QAAQ,GAAGgB,QAAUhB,QAAQU,KAAK,QACvCV,QAAQ,GAAGW,OACXT,GAAGK,YAAY,gBACfL,GAAGM,SAAS,aAGRT,WAEAA,UAAS,GAKbK,YAAYN,oBACZI,GAAGK,YAAY,gBACfL,GAAGM,SAAS,aAxBZR,QAAQ,GAAGkB,QAKXhB,GAAGK,YAAY,WACfL,GAAGM,SAAS,oBAuBpBf,EAAE,IAAMI,UAAY,6BAA6BsB,GAAG,QAAS,iBAAgB,WACzEnB,QAAQ,GAAGkB,YACPE,cAAgB3B,EAAE4B,MAAMX,KAAK,sBACjCR,GAAGK,YAAY,gBACfL,GAAGM,SAAS,WACZV,mBAAqBsB,cACrBhB,YAAYgB,kBAjFM,mBACdE,UAAYnB,aAAaU,OACpBR,YAAY,EAAGA,YAAciB,UAAWjB,cAC7CZ,EAAEU,aAAaE,cAAcK,KAAK,qBAAqBL,aAkF/DkB"}